<div class="container">

  <h2 class="m_30">マイページ</h2>

  <div class="profile_gr">

    <div class="profile_img"><%= image_tag @user.profile_image if @user.profile_image.attached? %></div>

    <div class="profile_text">
      <p>プロフィール</p>

        <%= simple_format(@user.profile, class: 'profile') %>

    </div>

    <div class="user_name">
        ユーザー名：<br><%= @user.username %>
        <% if @user.id == current_user.id %>
          <%= @user.email %>
          <% else %>
          <% if current_user.following?(@user) %>
            <%= link_to 'フォロー外す', user_unfollow_path(@user), method: :POST, class: 'unfollow' %>
            <% else %>
            <%= link_to 'フォローする', user_follow_path(@user), method: :POST, class: 'follow' %>
            <% end %>
        <% end %>
      <div class="link_gr">
        <%= link_to '編集', edit_user_path(@user) %>
        <%= link_to '削除', @user, method: :delete, data: {confirm: "#{@user.username}を削除します。よろしいですか？"} %>
      </div>
    </div>
  </div>

  <ul class="tabs">
    <li class="tab_item"><a href="" class="active">投稿レビュー</a></li>
    <li class="tab_item"><a href="">ブックマーク</a></li>
    <li class="tab_item"><a href="">フォロー中</a></li>
    <li class="tab_item"><a href="">フォロワー</a></li>
  </ul>

  <ul class="contents">
    <li class="active">
      <div class="grid_table_mypage">
        <% @user.reviews.each do |review| %>
        <div class="border_layout"><%= review.room.name %></div>
        <div class="border_layout"><%= review.score %></div>
        <div class="border_layout"><%= review.comment %></div>
        <% end %>
      </div>
    </li>
    <li>
      <% @rooms.each do |room| %>
      <div class="border">
        <h2 class="card_title"><%= room.name %></h2>
        <div class="card_inner">
          <div class="w_50"><%= image_tag room.image if room.image.attached? %></div>
          <div class="w_50">
            <div class="star_review">
              <div class="star-rating">
                <div class="star-rating-front" style="width: <%= room.review_score_percentage %>%">★★★★★</div>
                <div class="star-rating-back">★★★★★</div>
              </div>
              <div class="average-score-display">
                <%= room.avg_score %>点（<%= room.reviews.count %>件のレビュー）
              </div>
            </div>

            <p class="roomfee">&yen;<%= room.price.try(:to_s, :delimited) %>&nbsp;-&nbsp;&yen;<%= room.maxprice.try(:to_s, :delimited) %><span class="utilities">(光熱費込)</span></p>
            <%=simple_format(room.description, class: 'desc') %>

            <%= render 'reviews/tag_list', tag_list: room.tag_list %>


            <p class="link_bottons">
              <%= link_to "レビューを見る", room_reviews_path(room), class: "button" %>
              <%= link_to "レビューを書く", room_path(room), class: "button link_button" %>
            </p>
          </div>
        </div>
      </div>
      <% end %>
    </li>
    <li>
      <% @user.following_users.each do |follow_user| %>
      <%= follow_user.username %>
      <%= image_tag @user.profile_image if @user.image.attached? %>
      <%= @user.profile %>
      <% end %>

    </li>
    <li>
      <% @user.follower_users.each do |followerd_user| %>
      <%= followerd_user.username %>
      <%= image_tag @user.profile_image if @user.profile_image.attached? %>
      <%= @user.profile %>
      <% end %>
    </li>
  </ul>
</div>

<script data-turbolinks-eval="false">
  const tabs = document.querySelectorAll(".tabs li a");
  const contents = document.querySelectorAll(".contents li");

  for (let i = 0; i < tabs.length; i++) {
    tabs[i].addEventListener("click", function(e) {
      e.preventDefault();

      for (let j = 0; j < tabs.length; j++) {
        tabs[j].classList.remove("active");
      }
      for (let j = 0; j < contents.length; j++) {
        contents[j].classList.remove("active");
      }

      this.classList.add("active");
      contents[i].classList.add("active");
    });
  }
</script>